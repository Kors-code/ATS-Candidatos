<IfModule mod_headers.c>

    # Force browser not to sniff content
    Header always set X-Content-Type-Options "nosniff"
    
    # Protect against XSS
    Header set X-XSS-Protection "1; mode=block"

    # Protection against clickjacking
    Header set X-Frame-Options "DENY"

    # HSTS: forces HTTPS (2 years, include subdomains, preload)
    Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"

    # Prevent server error information disclosure (X-Powered-By)
    Header unset X-Powered-By
    Header always set Referrer-Policy "strict-origin-when-cross-origin"

    # Comprehensive Content Security Policy (Adjust 'unsafe-inline' and 'unsafe-eval' if possible)
    Header set Content-Security-Policy "default-src 'self'; script-src 'self'; style-src 'self'; img-src 'self' data:; font-src 'self'; object-src 'none'; frame-ancestors 'none'; form-action 'self'; base-uri 'self'; upgrade-insecure-requests;"
    # Secure Cookies: HttpOnly, Secure, SameSite=Lax (consider setting SameSite=Strict in app for critical cookies)
    Header always edit Set-Cookie ^(.*)$ "$1; HttpOnly; Secure; SameSite=Lax"

    Header always set Permissions-Policy "geolocation=(), camera=(), microphone=(), fullscreen=(self), payment=()"
    # Cache Control for static assets (1 year)
    <FilesMatch "\.(ico|jpg|jpeg|png|gif|js|css|woff|woff2|ttf|svg)$">
        Header set Cache-Control "max-age=31536000, public"
    </FilesMatch>

    # No cache for dynamic content (HTML, PHP, JSON)
    <FilesMatch "\.(html|htm|php|json)$">
        Header set Cache-Control "no-store, no-cache, must-revalidate, max-age=0"
        Header set Pragma         "no-cache"
        Header set Expires        "0"
    </FilesMatch>

</IfModule>

<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^ index.php [L]
</IfModule>

########################################
# 9) PROTECT SENSITIVE FILES
########################################
<FilesMatch "(\.env|composer\.(json|lock)|package\.json|artisan|\.gitignore|\.ht.*)$">
    Require all denied
</FilesMatch>
RedirectMatch 404 /\.git
RedirectMatch 404 /storage/logs

########################################
# 10) COMPRESSION
########################################
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>

########################################
# 11) OTHERS
########################################
Options -Indexes

<IfModule mod_mime.c>
    AddType text/html                .html .htm
    AddType text/css                 .css
    AddType application/javascript   .js
    AddType image/webp               .webp
</IfModule>


